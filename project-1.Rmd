---
title: "project"
author: ""
date: "2025-11-25"
output: html_document
---

# Load the dataset we need 
```{r, warning=FALSE}
library(tidyverse)
library(readr)
library(ggplot2)
library(gridExtra)
library(reshape2)
library(factoextra)
library(psych)
```

# import the dataset 
```{r}
data <- read.csv("Heart.csv", header = TRUE, stringsAsFactors = FALSE)

```


# We transform the categorical variables into numerical ones
```{r}
# AHD only has two categories 
data$AHD <- ifelse(data$AHD == "Yes", 1, 0)
```


## We have some variables that has more than two categories so we can not do it like previously, we need to make dummies
```{r}
categorical_vars <- c("ChestPain", "RestECG", "Slope", "Ca", "Thal")
data[categorical_vars] <- lapply(data[categorical_vars], as.factor)

```

# As we have some missing values we compute a imputation 
```{r}
# for categorical variables 
for(col in categorical_vars){
  data[[col]] <- addNA(data[[col]])
  levels(data[[col]])[is.na(levels(data[[col]]))] <- "missing"
}
```


```{r}
#for numerical variables 
# We put NA as 0
num_cols <- sapply(data, is.numeric)
data[num_cols] <- lapply(data[num_cols], function(x) ifelse(is.na(x), 0, x))

```

#create dummies
```{r}
dummies <- model.matrix(~ ChestPain + RestECG + Slope + Ca + Thal - 1, data = data)
dummies <- as.data.frame(dummies)
```


# we join the data frame we create with our data 
```{r}
num_data <- data[sapply(data, is.numeric)]
num_data$X <- NULL

new_data <- cbind(num_data, dummies)


```


# summary of our data 
```{r}
summary(new_data)

```

```{r}
describe(new_data)
```


# I'm not sure about these
```{r,warning=FALSE}
# Continuous numeric variables
cont_vars <- c("Age", "RestBP", "Chol", "MaxHR", "Oldpeak")

# Histograms
par(mfrow=c(2,3))
for (var in cont_vars) {
  hist(new_data[[var]], main=paste("Histogram of", var),
       xlab=var, col="lightblue", breaks=20)
}
par(mfrow=c(1,1))

# Dummy / categorical variables
dummy_vars <- names(new_data)[!(names(new_data) %in% cont_vars)]
dummy_vars <- dummy_vars[!dummy_vars %in% "AHD"]  # exclude target

# Bar plots
for (var in dummy_vars) {
  print(ggplot(new_data, aes_string(x=var)) + 
          geom_bar(fill="lightgreen") + 
          ggtitle(paste("Bar plot of", var)))
}

```




```{r}
for (var in cont_vars) {
  qqnorm(new_data[[var]], main=paste("Q-Q plot of", var))
  qqline(new_data[[var]])
}


```



```{r}
new_data$Chol_log <- log10(new_data$Chol + 1)  # evitar log(0)
hist(new_data$Chol_log)

```

#outliers
# visual with boxplots 
```{r}
par(mfrow=c(2,3))
for (var in cont_vars) {
  boxplot(new_data[[var]], main=paste("Boxplot of", var))
}
par(mfrow=c(1,1))

```


#numerical 
```{r}
for (var in cont_vars) {
  Q1 <- quantile(new_data[[var]], 0.25)
  Q3 <- quantile(new_data[[var]], 0.75)
  IQR <- Q3 - Q1
  outliers <- new_data[[var]][new_data[[var]] < (Q1 - 1.5*IQR) | new_data[[var]] > (Q3 + 1.5*IQR)]
  print(paste(var, "outliers:", length(outliers)))
}


```
#we have some outliers, we need to remove them 





